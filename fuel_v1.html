<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fuel Prices</title>
  <link href="https://fonts.googleapis.com/css2?family=Electrolize&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: white;
      font-family: 'Electrolize', sans-serif;
      width: 427px;
      height: 398px;
      overflow: hidden;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #f7aa08;
      color: #000;
    }
    th, td {
      padding: 4px;
      text-align: center;
    }
    th {
      background-color: #5c5c57;
      color: white;
    }
    #updated {
      text-align: center;
      color: white;
      margin-top: 5px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <table id="fuel-table">
    <thead>
      <tr>
        <th>Location</th>
        <th>Commodity</th>
        <th>Price (aUEC)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="updated">Last updated: --:-- UTC</div>

  <script>
    const apiUrl = "https://api.uexcorp.space/2.0/fuel_prices_all";
    const validIds = [1, 2, 85, 84, 70, 61, 124, 71];

    async function fetchData() {
      try {
        const res = await fetch(apiUrl);
        const json = await res.json();

        const filtered = json.data.filter(item => validIds.includes(item.id));
        const sorted = filtered.sort((a, b) => {
          if (a.terminal_name !== b.terminal_name) {
            return a.terminal_name.localeCompare(b.terminal_name);
          }
          if (a.commodity_name !== b.commodity_name) {
            return a.commodity_name.localeCompare(b.commodity_name);
          }
          return a.price_buy - b.price_buy;
        });

        const tbody = document.querySelector("#fuel-table tbody");
        tbody.innerHTML = "";
        sorted.forEach(item => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${item.terminal_name}</td>
            <td>${item.commodity_name}</td>
            <td>${item.price_buy} aUEC</td>
          `;
          tbody.appendChild(row);
        });

        const now = new Date();
        const utcTime = now.toUTCString().match(/\d{2}:\d{2}/)[0]; // Extract HH:MM
        document.getElementById("updated").textContent = `Last updated: ${utcTime} UTC`;

      } catch (err) {
        console.error("Error fetching data:", err);
      }
    }

    fetchData();
    setInterval(fetchData, 15 * 60 * 1000); // Every 15 minutes
  </script>
</body>
</html>
